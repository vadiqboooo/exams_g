# Настройка телеграм-бота для регистрации на экзамены

## Шаги для запуска

### 1. Применение миграций базы данных

Перейдите в папку `backend` и выполните миграции:

```bash
cd exams_g/backend
alembic upgrade head
```

Это добавит в таблицу `student` поля:
- `user_id` - Telegram ID пользователя
- `class_num` - Класс ученика (9, 10, 11)
- `confirmed_at` - Время подтверждения регистрации

И создаст таблицу `exam_registration` для записей на пробники.

### 2. Создание телеграм-бота

1. Откройте Telegram и найдите бота [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и получите токен бота
4. Сохраните токен

### 3. Настройка переменных окружения

В папке `telegram_bot` создайте файл `.env` (или установите переменные окружения):

```bash
export TELEGRAM_BOT_TOKEN="your_bot_token_here"
```

Или создайте файл `.env`:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

### 4. Установка зависимостей

```bash
cd exams_g/telegram_bot
pip install -r requirements.txt
```

### 5. Запуск бэкенда

Убедитесь, что бэкенд запущен:

```bash
cd exams_g/backend
uvicorn main:app --reload
```

Бэкенд должен быть доступен на `http://localhost:8000`

### 6. Запуск телеграм-бота

```bash
cd exams_g/telegram_bot
python bot.py
```

## Функционал бота

1. **Старт**: При команде `/start` бот показывает приветственное сообщение с кнопкой "Записаться"

2. **Поиск ученика**: После нажатия "Записаться" бот просит ввести ФИО и ищет ученика в базе данных

3. **Подтверждение**: Если найдено несколько учеников, показывается список для выбора. После выбора ученик подтверждается и привязывается Telegram ID

4. **Выбор предметов**: В зависимости от класса (9 - ОГЭ, 10-11 - ЕГЭ) показывается список предметов

5. **Запись на экзамен**: 
   - Выбор даты (5-10, 12 января 2026)
   - Выбор времени (9:00 или 12:00)
   - Максимум 4 экзамена на ученика
   - Максимум 45 человек на один слот

6. **Система уведомлений**:
   - Напоминание через 24 часа после подтверждения, если не записался на экзамен
   - Уведомление за 3 дня до экзамена с подтверждением участия
   - Уведомление за 1 день до экзамена

## API эндпоинты

Все эндпоинты доступны по префиксу `/telegram`:

- `POST /telegram/search-student` - Поиск ученика по ФИО
- `POST /telegram/confirm-student` - Подтверждение ученика и привязка Telegram ID
- `GET /telegram/subjects/{class_num}` - Получение списка предметов
- `POST /telegram/register-exam` - Запись на экзамен
- `GET /telegram/available-slots/{date}` - Получение доступных слотов
- `GET /telegram/student-registrations/{student_id}` - Получение записей ученика
- `POST /telegram/confirm-participation/{registration_id}` - Подтверждение участия
- `GET /telegram/pending-notifications` - Получение списка уведомлений для отправки

## Предметы

**ОГЭ (9 класс):**
- Русский язык
- Математика
- Обществознание
- История
- Биология
- Химия
- Физика
- Информатика
- География
- Английский язык
- Литература

**ЕГЭ (10-11 классы):**
- Русский язык
- Математика (профиль)
- Математика (база)
- Обществознание
- История
- Биология
- Химия
- Физика
- Информатика
- География
- Английский язык
- Литература

## Даты экзаменов

- Понедельник 5.01.26
- Вторник 6.01.26
- Среда 7.01.26
- Четверг 8.01.26
- Пятница 9.01.26
- Суббота 10.01.26
- Воскресенье 12.01.26

## Время экзаменов

- 9:00
- 12:00

## Ограничения

- Максимум 4 экзамена на одного ученика
- Максимум 45 человек на один временной слот (дата + время)


